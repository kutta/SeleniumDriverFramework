
package com.comverse.upm.UpmBct;

/**
 * 
 * @author osmolya
 */

import com.thoughtworks.selenium.*;
import com.comverse.upm.common.*;
import com.comverse.upm.upmPages.*;


import org.junit.After;
// import org.junit.Before;
import org.junit.Test;


public class UpmRunCpm {
	public Selenium selenium;
/*	@Before
	public void setUp() throws Exception {		
		selenium=Prep.startSeleniumAndOpenUpmHome(selenium);
	}
*/

	private UpmPrep Prep = new UpmPrep();
	private String templateName = "Auto_CPM";
	private Boolean templateExists;
	private String moduleName = "CPM";
	private String nodeType = "billing";
	private String serverId = "CUST1";
	private String defaultTaskName = "Create";
	private String workflowType="CBS Batch Process";
	private String taskMode="Production";
	private int DefaultStateCheckIterations=20;

	
	@Test
	public void call_CPM_workflow_with_task_name() throws Exception
	{
		// Stub for calling CPM batch workflow
		// update default task name manually if not calling test_upm_bct_bp_workflow
		// from another script
		test_upm_bct_CPM_workflow(defaultTaskName);
	}
	
	
	public Selenium test_upm_bct_CPM_workflow(String taskName) throws Exception {
		
		selenium=Prep.startSeleniumAndOpenUpmHome(selenium);
		
		UpmUtils Utils = new UpmUtils(selenium);
		UpmNavigation Navigate = new UpmNavigation(selenium);
		UpmValidation Validate = new UpmValidation(selenium);
		ProcessPage processPage = new ProcessPage(selenium);
		
		//Check whether login screen is present and log in if required
		Utils.UpmCheckWhetherLoggedInAndLogIn();		
		
		//Go to Process-> Workflow tab
		Navigate.goToProcessWorkflow();
		
        processPage.selectTemplateWorkflowType(workflowType);
		//Check whether Auto_CPM template exists; if not create by invoking createJnlTemplate class		
		templateExists=Utils.checkTemplate(templateName);
		
		//Proceed to create new template only if it does not already exist
		if (!(templateExists))
		{
			
			Utils.upm_create_template(templateName,moduleName,nodeType,serverId,taskMode,taskName);
		}
		
		//Run template
		Utils.runPaymentTemplate(templateName,taskName);
		
		//Go to History tab and click Refresh until last created workflow is Completed
		//If does not complete in default # of iterations, test will fail
		Validate.validateLastWorkflowCompleted(DefaultStateCheckIterations);
	    return selenium;
	}	
	
	@After
	public void tearDown() throws Exception {
		selenium.stop();
	}
}


